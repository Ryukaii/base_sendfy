<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>Pagamento PIX</title>
    <link rel="stylesheet" href="https://cdn.replit.com/agent/bootstrap-agent-dark-theme.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet"/>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet"/>
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        .pix-container {
            max-width: 800px;
            margin: 0 auto;
        }
        .pix-qr {
            max-width: 200px;
            height: auto;
            margin: 0 auto;
        }
        .pix-code {
            user-select: all;
            font-family: monospace;
            background-color: var(--bs-dark);
            color: var(--bs-light);
            padding: 1rem;
            border-radius: 0.5rem;
            margin: 1rem 0;
            word-break: break-all;
        }
        .countdown {
            font-size: 2rem;
            font-weight: bold;
            color: var(--bs-primary);
        }
    </style>
</head>
<body>
    <header class="bg-dark py-3 mb-4">
        <div class="container text-center">
            <div id="countdown" class="countdown mb-2">09:00</div>
            <div class="d-flex align-items-center justify-content-center">
                <i class="fas fa-clock text-primary me-2"></i>
                <span class="text-light">Aguardando Pagamento</span>
            </div>
        </div>
    </header>

    <main class="container pix-container flex-grow-1 mb-4">
        <div class="card">
            <div class="card-body">
                <div class="text-center mb-4">
                    <img src="{{ pix_qr_code }}" alt="PIX QR Code" class="pix-qr mb-3" onerror="this.style.display='none'">
                    <img src="https://logospng.org/download/pix/logo-pix-512.png" alt="PIX Logo" class="img-fluid" style="max-height: 80px;">
                </div>

                <h2 class="card-title">Pagamento via PIX</h2>
                
                <div class="mb-4">
                    <p class="mb-2">
                        <strong>Nome:</strong> {{ customer_name }}
                    </p>
                    {% if customer_address %}
                    <p class="mb-2">
                        <strong>Endereço:</strong> {{ customer_address }}
                    </p>
                    {% endif %}
                    <p class="mb-2">
                        <strong>Produto:</strong> {{ product_name }}
                    </p>
                    <p class="mb-2">
                        <strong>Valor:</strong> R$ {{ total_price }}
                    </p>
                </div>

                <div class="alert alert-info">
                    <div class="d-flex align-items-center mb-3">
                        <i class="fas fa-shield-alt fa-2x text-primary me-3"></i>
                        <span>Pagamento 100% Seguro e Verificado pelo Banco Central</span>
                    </div>
                    <p class="mb-2">Copie o código Pix abaixo:</p>
                    <div class="pix-code" id="pixCode">{{ pix_code }}</div>
                </div>

                <button class="btn btn-primary w-100 mb-4" onclick="copiarPixCode()">
                    <i class="fas fa-copy me-2"></i>
                    Copiar Código PIX
                </button>

                <div class="card bg-dark">
                    <div class="card-body">
                        <h5 class="card-title">
                            <i class="fas fa-info-circle me-2"></i>
                            Como pagar com PIX:
                        </h5>
                        <div class="steps">
                            <div class="step d-flex align-items-start mb-3">
                                <div class="btn btn-primary btn-sm me-3">1</div>
                                <div>
                                    <h6>Copie o código PIX</h6>
                                    <small class="text-muted">Clique no botão acima para copiar automaticamente</small>
                                </div>
                            </div>
                            <div class="step d-flex align-items-start mb-3">
                                <div class="btn btn-primary btn-sm me-3">2</div>
                                <div>
                                    <h6>Abra seu banco</h6>
                                    <small class="text-muted">Acesse o aplicativo do seu banco preferido</small>
                                </div>
                            </div>
                            <div class="step d-flex align-items-start mb-3">
                                <div class="btn btn-primary btn-sm me-3">3</div>
                                <div>
                                    <h6>Selecione PIX Copia e Cola</h6>
                                    <small class="text-muted">Encontre a opção PIX > Pix Copia e Cola</small>
                                </div>
                            </div>
                            <div class="step d-flex align-items-start">
                                <div class="btn btn-primary btn-sm me-3">4</div>
                                <div>
                                    <h6>Confirme o pagamento</h6>
                                    <small class="text-muted">Cole o código e confirme a transação</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer class="bg-dark py-3">
        <div class="container text-center">
            <img src="https://logospng.org/download/banco-central-do-brasil/logo-banco-central-256.png" alt="Banco Central do Brasil" style="max-height: 40px;">
        </div>
    </footer>

    <div class="toast position-fixed bottom-0 end-0 m-3" role="alert" aria-live="assertive" aria-atomic="true">
        <div class="toast-header">
            <i class="fas fa-check-circle text-success me-2"></i>
            <strong class="me-auto">Sucesso</strong>
            <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
        </div>
        <div class="toast-body">
            Código PIX copiado com sucesso!
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Countdown timer
        function startTimer(duration, display) {
            let timer = duration, minutes, seconds;
            const interval = setInterval(function () {
                minutes = parseInt(timer / 60, 10);
                seconds = parseInt(timer % 60, 10);

                minutes = minutes < 10 ? "0" + minutes : minutes;
                seconds = seconds < 10 ? "0" + seconds : seconds;

                display.textContent = minutes + ":" + seconds;

                if (--timer < 0) {
                    clearInterval(interval);
                    display.textContent = "00:00";
                    window.location.reload();
                }
            }, 1000);
        }

        window.onload = function () {
            const nineMinutes = 60 * 9;
            const display = document.querySelector('#countdown');
            startTimer(nineMinutes, display);
        };

        // Copy PIX code
        function copiarPixCode() {
            const pixCode = document.getElementById("pixCode");
            const toast = new bootstrap.Toast(document.querySelector('.toast'));
            
            try {
                navigator.clipboard.writeText(pixCode.textContent).then(function() {
                    toast.show();
                }).catch(function(err) {
                    console.error('Failed to copy: ', err);
                });
            } catch (err) {
                console.error('Failed to copy: ', err);
            }
        }
    </script>
</body>
</html>
